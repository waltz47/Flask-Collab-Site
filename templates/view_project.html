{% extends "base.html" %}
{% block title %}View Project{% endblock %}
{% block content %}
<h2 class="mb-4">{{ project.title }}</h2>
<p><strong>Posted by:</strong> <a href="/user/{{ project.owner }}">{{ project.owner }}</a></p>
<p><strong>Category:</strong> {{ project.category }}</p>
<p><strong>Deadline:</strong> {{ project.deadline }}</p>
<p><strong>Last Updated:</strong> {{ project.last_updated.strftime('%Y-%m-%d %H:%M') }}</p>
<p>{{ project.description }}</p>
{% if project.users|length > 1 %}
    <p><strong>Other Users:</strong>
        {% for user in project.users %}
            {% if user.username != project.owner %}
                <a href="/user/{{ user.username }}">{{ user.username }}</a>{% if not loop.last %}, {% endif %}
            {% endif %}
        {% endfor %}
    </p>
{% endif %}
{% if project.milestones %}
    <h3>Milestones</h3>
    <ul class="list-group">
        {% for milestone in project.milestones %}
            <li class="list-group-item 
                {% if milestone.status == 'completed' %}bg-success text-white{% elif milestone.status == 'overdue' %}bg-danger text-white{% else %}bg-light{% endif %}">
                <strong>{{ milestone.description }}</strong>
                {% if milestone.deadline %}
                    <span class="float-end">Deadline: {{ milestone.deadline.strftime('%Y-%m-%d') }}</span>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% endif %}
<div id="projectCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
        {% if project.project_images %}
            {% for image in project.project_images.split(',') %}
                <div class="carousel-item {% if loop.first %}active{% endif %}">
                    <img src="/static/uploads/{{ image.strip() }}" class="d-block w-100 img-fluid img-thumbnail carousel-image" alt="Project Image">
                </div>
            {% endfor %}
        {% else %}
            <div class="carousel-item active">
                <p>No image for this project.</p>
            </div>
        {% endif %}
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#projectCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#projectCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>
{% if session['username'] == project.owner or session['username'] in project.users|map(attribute='username') %}
    <a href="/edit-project/{{ project.id }}" class="btn btn-primary mt-3">Edit Project</a>
{% endif %}
<a href="/browse-projects" class="btn btn-primary mt-3">Back to Browse Projects</a>
{% endblock %}
